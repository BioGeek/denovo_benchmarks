Bootstrap: docker
From: chryzl/casanovo_spectralis:amd64

# Define system variables to provide GPU access within the container.
%environment
    export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH

%files
    # Copy algorithm-related files to a separate dir /algo.
    algorithms/spectralis /algo
    algorithms/base /algo/base

%post
	# Download weigths for both Casanovo and Spectralis
    cd /algo
    curl -O https://github.com/Noble-Lab/casanovo/releases/download/v4.2.0/casanovo_nontryptic.ckpt

    curl -O https://zenodo.org/records/8393846/files/spectralis_bin_reclass.pt
    curl -O https://zenodo.org/records/8393846/files/spectralis_score.pkl
    
%post
	# Make sure make_predictions.sh file is executable.
    chmod +x /algo/make_predictions.sh
    
# Run algorithm and convert outputs.
# Data is expected to be mounted into /algo/data dir.
%runscript
    cd /algo && ./make_predictions.sh data
